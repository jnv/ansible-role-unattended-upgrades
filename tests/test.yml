---
- name: Bring up Docker containers
  hosts: localhost
  gather_facts: false
  vars:
    inventory:
      - name: ubuntu_rolling
        image: "ubuntu:rolling"
      - name: ubuntu_latest
        image: "ubuntu:latest"
      - name: ubuntu_trusty
        image: "ubuntu:trusty"
      - name: debian_testing
        image: "debian:testing"
      - name: debian_stable
        image: "debian:stable"
      - name: debian_oldstable
        image: "debian:oldstable"
  roles:
    - role: provision_docker
      provision_docker_inventory: "{{ inventory }}"
      provision_docker_privileged: true
      provision_docker_use_docker_connection: true

- name: Test role
  hosts: docker_containers
  gather_facts: false
  pre_tasks:
    - name: Provision Python
      raw: bash -c "test -e /usr/bin/python || (apt-get -y update && apt-get install -y python-simplejson)"
      register: output
      changed_when: output.stdout
    - setup: # Gather facts
  vars:
    # Enforce apt update
    # unattended_cache_valid_time: 0
  roles:
    # Searched for in ../.. (see ansible.cfg)
    - ansible-role-unattended-upgrades
